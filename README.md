# KiriPet宠物百科与服务平台

### 平台简介

KiriPet宠物百科与服务平台是一个面向宠物爱好者的综合性互联网服务平台，旨在为用户提供全方位的宠物相关服务和信息资源。我们致力于达成以下目标：

1. 提升宠物养护质量：通过提供科学的宠物百科内容，帮助宠物主人了解宠物的饮食、护理、健康管理等方面的知识，提高宠物养护质量，减少误区和错误养护方式。
2. 多元化宠物服务：平台通过提供多种宠物服务，如宠物美容、洗护、寄养等，为宠物主人提供便捷、高质量的服务体验，解决传统宠物服务资源不足和服务质量参差不齐的问题。
3. 一站式购物体验：通过宠物商城模块，整合各种宠物食品、玩具、日常用品等商品，提供一站式购物体验，方便宠物主人购买到优质且实用的宠物产品。
4. 社会化与社区建设：为宠物主人提供社交平台，建立一个宠物爱好者社区，促进宠物主人之间的交流与合作

### 技术栈与项目背景
- 技术栈：` Vue3 + TypeScript + WebSocket + TensorFlow Lite `
- 项目背景：如今，越来越多的人把宠物当作家人。每次看着朋友手忙脚乱地切换五六个APP——这边查宠物医院评价，那边找靠谱美容师，中间还要刷论坛学养护知识，甚至因为过时信息白跑一趟时，我都想：为什么不能有个像"宠物版大众点评+知乎+美团"的平台？于是我便着手打造自己的宠物资源整合平台，KiriPet由此诞生。

### EmojiPicker 实现与表情渲染

#### 表情选择器组件设计
EmojiPicker 组件实现了一个功能完善的表情选择器，支持普通emoji和自定义GIF表情的插入：

1. **分类系统**：表情按不同类别组织（表情、动物、旅行等），并增加了专门的"doro"类别用于GIF表情。
2. **响应式布局**：常规emoji使用8列布局，而GIF表情采用4列布局以适应较大尺寸。
3. **预加载机制**：针对GIF表情实现了预加载，提升用户体验。
4. **事件委托**：通过自定义事件`select-emoji`和`update:visible`实现与父组件的通信。

#### 表情插入机制
表情插入实现了高级的光标追踪和内容编辑功能：

1. **contenteditable实现**：使用`contenteditable`属性的div替代传统textarea，支持插入HTML内容。
2. **光标位置管理**：
   - 维护`lastCursorPosition`变量跟踪光标位置
   - 添加键盘和鼠标事件监听器保存光标位置
   - 实现`saveCursorPosition`和`initInputCursor`函数管理光标状态

3. **不同类型表情的处理**：
   - 常规emoji：直接作为文本节点插入
   - GIF表情：创建img元素并设置适当的样式和属性

4. **发送后的状态重置**：
   - 消息发送后清空输入框
   - 重置光标位置
   - 聚焦输入框并初始化光标

#### 样式处理
为确保表情在不同上下文中正确显示，实现了多层次样式控制：

1. **输入框中的表情**：控制大小为较小尺寸（24px），保持输入体验
2. **消息区域中的表情**：显示为较大尺寸（60px），增强可读性
3. **GIF特殊处理**：为GIF表情添加边框半径、边距等样式，提升视觉效果

#### 技术难点与解决方案
1. **光标位置问题**：
   - 问题：插入表情后光标位置错误
   - 解决：使用`cloneRange()`复制范围对象，防止引用问题，并在插入后精确定位光标

2. **不同浏览器兼容性**：
   - 问题：Firefox/Safari中的输入行为差异
   - 解决：添加input事件监听器，确保空输入框有基础DOM结构`<br>`

3. **表情渲染一致性**：
   - 问题：表情在不同位置大小不一致
   - 解决：通过CSS深度选择器`:deep()`实现不同上下文的样式隔离

